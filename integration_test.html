<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Integraci√≥n - Sistema de 3 Niveles</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <h1>üß™ Test de Integraci√≥n - Sistema de 3 Niveles</h1>
    
    <div class="test-section">
        <h2>1Ô∏è‚É£ Test de Inicializaci√≥n</h2>
        <button onclick="testInitialization()">Probar Inicializaci√≥n</button>
        <div id="init-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2Ô∏è‚É£ Test de Gesti√≥n de Niveles</h2>
        <button onclick="testLevelManagement()">Probar Gesti√≥n de Niveles</button>
        <div id="level-result"></div>
    </div>
    
    <div class="test-section">
        <h2>3Ô∏è‚É£ Test de Progresi√≥n de Palabras</h2>
        <button onclick="testWordProgression()">Probar Progresi√≥n</button>
        <div id="progression-result"></div>
    </div>
    
    <div class="test-section">
        <h2>4Ô∏è‚É£ Test de Estad√≠sticas</h2>
        <button onclick="testStatistics()">Probar Estad√≠sticas</button>
        <div id="stats-result"></div>
        <div class="progress-bar">
            <div class="progress-fill" id="test-progress" style="width: 0%"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>5Ô∏è‚É£ Test de Repaso Inteligente</h2>
        <button onclick="testSmartReview()">Probar Repaso Inteligente</button>
        <div id="review-result"></div>
    </div>
    
    <div class="test-section">
        <h2>6Ô∏è‚É£ Test Completo del Sistema</h2>
        <button onclick="runFullTest()">Ejecutar Test Completo</button>
        <div id="full-result"></div>
    </div>

    <script>
        // Simulated 3-level system for testing
        let testProgress = {
            wordProgress: {
                new: new Set(),
                learning: new Set(),
                mastered: new Set()
            },
            difficultyMap: {},
            reviewSchedule: {},
            errorCount: {},
            lastSeen: {},
            correctStreak: {},
            categoryProgress: {}
        };

        function getWordLevel(wordId) {
            if (testProgress.wordProgress.mastered.has(wordId)) return 'mastered';
            if (testProgress.wordProgress.learning.has(wordId)) return 'learning';
            return 'new';
        }

        function moveWordToLevel(wordId, newLevel) {
            const currentLevel = getWordLevel(wordId);
            
            if (currentLevel === 'mastered') testProgress.wordProgress.mastered.delete(wordId);
            else if (currentLevel === 'learning') testProgress.wordProgress.learning.delete(wordId);
            else if (currentLevel === 'new') testProgress.wordProgress.new.delete(wordId);
            
            if (newLevel === 'mastered') testProgress.wordProgress.mastered.add(wordId);
            else if (newLevel === 'learning') testProgress.wordProgress.learning.add(wordId);
            else if (newLevel === 'new') testProgress.wordProgress.new.add(wordId);
        }

        function recordWordResult(wordId, isCorrect) {
            if (!testProgress.errorCount[wordId]) testProgress.errorCount[wordId] = 0;
            if (!testProgress.correctStreak[wordId]) testProgress.correctStreak[wordId] = 0;
            
            if (isCorrect) {
                testProgress.correctStreak[wordId]++;
                const currentLevel = getWordLevel(wordId);
                const streak = testProgress.correctStreak[wordId];
                
                if (currentLevel === 'new' && streak >= 2) {
                    moveWordToLevel(wordId, 'learning');
                } else if (currentLevel === 'learning' && streak >= 5) {
                    moveWordToLevel(wordId, 'mastered');
                }
            } else {
                testProgress.errorCount[wordId]++;
                testProgress.correctStreak[wordId] = 0;
                
                const currentLevel = getWordLevel(wordId);
                const errors = testProgress.errorCount[wordId];
                
                if (currentLevel === 'mastered' && errors >= 3) {
                    moveWordToLevel(wordId, 'learning');
                } else if (currentLevel === 'learning' && errors >= 5) {
                    moveWordToLevel(wordId, 'new');
                }
            }
        }

        function calculateStats() {
            const newCount = testProgress.wordProgress.new.size;
            const learningCount = testProgress.wordProgress.learning.size;
            const masteredCount = testProgress.wordProgress.mastered.size;
            const totalWords = newCount + learningCount + masteredCount;
            
            const progressPercentage = totalWords > 0 ? ((learningCount + masteredCount) / totalWords) * 100 : 0;
            
            return {
                new: newCount,
                learning: learningCount,
                mastered: masteredCount,
                total: totalWords,
                progress: Math.round(progressPercentage)
            };
        }

        function testInitialization() {
            const result = document.getElementById('init-result');
            try {
                testProgress = {
                    wordProgress: {
                        new: new Set(),
                        learning: new Set(),
                        mastered: new Set()
                    },
                    difficultyMap: {},
                    reviewSchedule: {},
                    errorCount: {},
                    lastSeen: {},
                    correctStreak: {},
                    categoryProgress: {}
                };
                
                result.innerHTML = '<div class="test-result success">‚úÖ Sistema inicializado correctamente</div>';
            } catch (error) {
                result.innerHTML = `<div class="test-result error">‚ùå Error en inicializaci√≥n: ${error.message}</div>`;
            }
        }

        function testLevelManagement() {
            const result = document.getElementById('level-result');
            try {
                const testWord = 'test_„Åì„Çì„Å´„Å°„ÅØ';
                
                // Test level changes
                moveWordToLevel(testWord, 'learning');
                const level1 = getWordLevel(testWord);
                
                moveWordToLevel(testWord, 'mastered');
                const level2 = getWordLevel(testWord);
                
                moveWordToLevel(testWord, 'new');
                const level3 = getWordLevel(testWord);
                
                result.innerHTML = `
                    <div class="test-result success">‚úÖ Gesti√≥n de niveles funcionando</div>
                    <div class="test-result info">
                        Nuevo ‚Üí Aprendiendo: ${level1}<br>
                        Aprendiendo ‚Üí Dominado: ${level2}<br>
                        Dominado ‚Üí Nuevo: ${level3}
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `<div class="test-result error">‚ùå Error en gesti√≥n de niveles: ${error.message}</div>`;
            }
        }

        function testWordProgression() {
            const result = document.getElementById('progression-result');
            try {
                const testWord = 'test_„ÅÇ„Çä„Åå„Å®„ÅÜ';
                let log = [];
                
                // Simulate progression
                log.push(`Inicial: ${getWordLevel(testWord)}`);
                
                // 2 correct answers -> should promote to learning
                recordWordResult(testWord, true);
                recordWordResult(testWord, true);
                log.push(`Despu√©s de 2 correctas: ${getWordLevel(testWord)}`);
                
                // 3 more correct -> should promote to mastered
                recordWordResult(testWord, true);
                recordWordResult(testWord, true);
                recordWordResult(testWord, true);
                log.push(`Despu√©s de 5 correctas: ${getWordLevel(testWord)}`);
                
                // 3 errors -> should demote to learning
                recordWordResult(testWord, false);
                recordWordResult(testWord, false);
                recordWordResult(testWord, false);
                log.push(`Despu√©s de 3 errores: ${getWordLevel(testWord)}`);
                
                result.innerHTML = `
                    <div class="test-result success">‚úÖ Progresi√≥n de palabras funcionando</div>
                    <div class="test-result info">${log.join('<br>')}</div>
                `;
            } catch (error) {
                result.innerHTML = `<div class="test-result error">‚ùå Error en progresi√≥n: ${error.message}</div>`;
            }
        }

        function testStatistics() {
            const result = document.getElementById('stats-result');
            try {
                // Add some test data
                moveWordToLevel('word1', 'new');
                moveWordToLevel('word2', 'learning');
                moveWordToLevel('word3', 'learning');
                moveWordToLevel('word4', 'mastered');
                moveWordToLevel('word5', 'mastered');
                
                const stats = calculateStats();
                
                // Update progress bar
                document.getElementById('test-progress').style.width = `${stats.progress}%`;
                
                result.innerHTML = `
                    <div class="test-result success">‚úÖ Estad√≠sticas calculadas correctamente</div>
                    <div class="test-result info">
                        üÜï Nuevas: ${stats.new}<br>
                        üìö Aprendiendo: ${stats.learning}<br>
                        ‚úÖ Dominadas: ${stats.mastered}<br>
                        üìä Total: ${stats.total}<br>
                        üìà Progreso: ${stats.progress}%
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `<div class="test-result error">‚ùå Error en estad√≠sticas: ${error.message}</div>`;
            }
        }

        function testSmartReview() {
            const result = document.getElementById('review-result');
            try {
                // Simulate review schedule
                const now = new Date();
                const tomorrow = new Date(now.getTime() + 24 * 60 * 60 * 1000);
                
                testProgress.reviewSchedule['word1'] = now.toISOString(); // Due today
                testProgress.reviewSchedule['word2'] = tomorrow.toISOString(); // Due tomorrow
                
                const dueToday = Object.keys(testProgress.reviewSchedule).filter(wordId => {
                    const reviewDate = new Date(testProgress.reviewSchedule[wordId]);
                    return reviewDate <= now;
                });
                
                result.innerHTML = `
                    <div class="test-result success">‚úÖ Repaso inteligente funcionando</div>
                    <div class="test-result info">
                        Palabras para revisar hoy: ${dueToday.length}<br>
                        Palabras programadas: ${Object.keys(testProgress.reviewSchedule).length}
                    </div>
                `;
            } catch (error) {
                result.innerHTML = `<div class="test-result error">‚ùå Error en repaso inteligente: ${error.message}</div>`;
            }
        }

        function runFullTest() {
            const result = document.getElementById('full-result');
            let allTestsPassed = true;
            let testLog = [];
            
            try {
                // Run all tests
                testInitialization();
                testLevelManagement();
                testWordProgression();
                testStatistics();
                testSmartReview();
                
                testLog.push('‚úÖ Todos los tests ejecutados correctamente');
                testLog.push('‚úÖ Sistema de 3 niveles completamente funcional');
                testLog.push('‚úÖ Progresi√≥n autom√°tica de palabras');
                testLog.push('‚úÖ Estad√≠sticas en tiempo real');
                testLog.push('‚úÖ Repaso inteligente');
                
                result.innerHTML = `
                    <div class="test-result success">üöÄ SISTEMA COMPLETAMENTE OPERATIVO</div>
                    <div class="test-result info">${testLog.join('<br>')}</div>
                `;
            } catch (error) {
                allTestsPassed = false;
                result.innerHTML = `
                    <div class="test-result error">‚ùå Error en test completo: ${error.message}</div>
                `;
            }
        }
    </script>
</body>
</html>
